<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>fuck de system</title>
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css"
      integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ=="
      crossorigin=""
    />
    <script
      src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js"
      integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew=="
      crossorigin=""
    ></script>
    <link
      rel="stylesheet"
      type="text/css"
      href="http://yui.yahooapis.com/3.18.1/build/cssnormalize/cssnormalize-min.css"
    />
    <style>
      body {
        overflow: hidden;
      }
      #mapid {
        height: 100vh;
        width: 100vw;
      }
      .leaflet-popup-publicatie {
        max-height: 250px;
        overflow: scroll;
      }
    </style>
  </head>
  <body>
    <div id="mapid"></div>
    <script>
      const heeftBevestigdHetTeSnappen = !!sessionStorage.getItem("snaptHet");

      if (!heeftBevestigdHetTeSnappen) {
        if (!confirm("KSU Oost mag dood neer vallen\nmet hun kuthouding")) {
          alert("kthxbai");
          location.href = "https://ksuoost.squat.net/";
        } else {
          sessionStorage.setItem("snaptHet", "true");
        }
      }

      function initMap() {
        const mymap = L.map("mapid").setView([52.3948545, 4.9336231], 13);
        L.tileLayer(
          "https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1Ijoic2plcnAtdmFuLXdvdWRlbiIsImEiOiJjajh5NmExaTAxa29iMzJwbDV0eXF4eXh4In0.HVBgF1SbusJzMwmjHcHS2w",
          {
            attribution:
              '<strong>FUCK KSU OOST. NOOOORD </strong>Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, <a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
            maxZoom: 18,
            id: "mapbox/streets-v11",
            tileSize: 512,
            zoomOffset: -1,
            accessToken: "your.mapbox.access.token",
          }
        ).addTo(mymap);
        return mymap;
      }

      window.onload = function () {
        const mymap = initMap();
        const vandaag = new Date().getTime();

        fetch("geconsolideerde-adressen.json")
          .then((res) => {
            return res.json();
          })
          .then((faillissementen) => {
            const markers = faillissementen.map((faillissement) => {
              // verder in het verleden opacity geven.
              let opacity = 1;
              if (!!faillissement.datum) {
                const fDatum = new Date(faillissement.datum).getTime();
                // To calculate the no. of days between two dates
                var verschilInDagen = (fDatum - vandaag) / (1000 * 3600 * 24);
                const verschilNietBovenNul = Math.max(0, verschilInDagen) / 10;
                opacity = opacity - verschilNietBovenNul;
                opacity = Math.max(opacity, 0.3);
              }

              console.log(opacity);

              const marker = L.marker([
                faillissement.lat,
                faillissement.lon,
                {
                  opacity: opacity,
                },
              ]).addTo(mymap);
              marker.bindPopup(
                `<div class='leaflet-popup-publicatie'>
                  ${
                    faillissement.datum
                      ? `<h3>${faillissement.datum}</h3><hr>`
                      : ""
                  }
                    ${faillissement.publicaties}
                  </div class='leaflet-popup-publicatie'>`
              );
            });
          })
          .catch((err) => {
            console.error(err);
          });
      };

      function datediff(first, second) {
        // Take the difference between the dates and divide by milliseconds per day.
        // Round to nearest whole number to deal with DST.
        return Math.round((second - first) / (1000 * 60 * 60 * 24));
      }
    </script>
  </body>
</html>
